{% extends 'baselogin.html' %}
{% block title %}Shop{% endblock %}

{% block content %}
<h2>Shop</h2>

{% if items|length == 0 %}
  <p>No items available.</p>
{% else %}
  {% for item in items %}
    {# If product_picture is a full path, extract just the filename #}
    {% set fname = (item.product_picture | replace('\\','/')).split('/')[-1] %}

    <div>
      {% if item.product_picture %}
        <img
          src="{{ url_for('admin.get_image', filename=fname) }}"
          alt="{{ item.product_name }}"
          width="120" height="120"
          loading="lazy" decoding="async">
      {% endif %}

      <h3>{{ item.product_name }}</h3>

      {% if item.in_stock|int > 0 %}
        <p>In stock ({{ item.in_stock }})</p>
        <form method="POST" action="{{ url_for('cart.add_item', product_id=item.id) }}">
          {{ csrf_token() if csrf_token is defined }}
          <input type="hidden" name="quantity" value="1">
          <button type="submit">Add to Cart</button>
        </form>
      {% else %}
        <p>Out of stock</p>
        <button type="button" disabled>Unavailable</button>
      {% endif %}
    </div>
    <hr>
  {% endfor %}
{% endif %}
{% endblock %}
